<!DOCTYPE html>
<html>
  <head>
   <center><h2>IoT Class Project</h2></center>
    <title>IoT Class Project </title>
    
    <!-- CSS-->    
    <style>
      #map-canvas {
        width: 500px;
        height: 400px;
      }
      p{
        align: right;
      }
    </style>
    
    <!-- EXTERNAL LIBS-->    
    <script src="https://maps.googleapis.com/maps/api/js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1.1','packages':['bar']}]}"></script>
    <script src="https://www.google.com/jsapi"></script>
    <script type="text/javascript" src="static/markerwithlabel.js"></script>

    <!-- EXAMPLE SCRIPT -->
    <script>
      // onload callback
      function drawChart() {

        var public_key = 'dZ4EVmE8yGCRGx5XRX1W';

        // JSONP request
        var jsonData = $.ajax({
          url: 'https://data.sparkfun.com/output/aGOE6rY5mxcxX1GNnOKq.json?gt[timestamp]=2015-07-29&timezone=America/New_York',
          data: {page: 1},
          dataType: 'jsonp',
        }).done(function (results) {

          var data = new google.visualization.DataTable();

          data.addColumn('datetime', 'Time');
          data.addColumn('number', 'Light');
          data.addColumn('number', 'Temperature');

          $.each(results, function (i, row) {
            data.addRow([
              (new Date(row.timestamp)),
              parseFloat(row.light),
              parseFloat(row.temperature)
            ]);
          });

        var options = {
            title: 'IOT Bar Chart',
        hAxis: {
          title: 'Temperature and Light Values'
        },
        vAxis: {
          title: 'TimeStamp'
        },
			width: 600,
			height: 400,
			colors: ['#1b9e77', '#d95f02'],
			bar: {groupWidth: "95%"},
        };


          var chart = new google.visualization.BarChart($('#chart').get(0));

          chart.draw(data, google.charts.Bar.convertOptions(options));

        });

      }

      // load chart lib
      google.load('visualization', '1', {
        packages: ['corechart']
      });

      // call drawChart once google charts is loaded
      google.setOnLoadCallback(drawChart);
    </script>
    
    <!-- MAP Script-->    
    <script>
      function initialize() {
        %for item in rows:
            var myCenter = new google.maps.LatLng({{item[0]}},{{item[1]}});
        %end
        var mapCanvas = document.getElementById('map-canvas');
        var mapOptions = {
          center: myCenter,
          zoom: 12,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        }

        var map = new google.maps.Map(mapCanvas, mapOptions)
        %for item in rows:
            var myCenter1 = new google.maps.LatLng({{item[0]}},{{item[1]}});
            var marker = new MarkerWithLabel({
                position: new google.maps.LatLng({{item[0]}},{{item[1]}}),
                draggable: true,
                raiseOnDrag: true,
                map: map,
                title: "Temperature:{{item[3]}} \n Light:{{item[2]}}"
                 });
        %end
      }

      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body bgcolor="#E6E6FA">
    <center>
    <h3> Map locating all Sensors with Light and Temperature values on Mouse Over</h3>
    <p> The Map marks the user locations according to the latitude and longitudes of class stream with temperature and light values on mouse over. To fetch the data I selected
        latest 100 hundrend entries of the current day from stream in json</p>
    <div id="map-canvas"></div>
    <h3> Bar Chart for temperature and Light</h3>
    <p> The Bar Chart displays the values of temperature and light in the form of horizantal bars. On MouseOver it will display the information of the bar in tooltip.
    As shown in the graph the Vertical Axis defines the TimeStamp values and Horizantal Axes defines the Light and Temerature values</p>
    <div id="chart" style="width:100%;"></div>
    </center>
  </body>
</html>
